# Zynq7010_eink_controller

## 这是一个基于Zynq7010的Eink控制器

EBAZ4205控制板搭载的也是ZYNQ7010前段时间在咸鱼20元+10元邮费就可以带回家了呢~

很快我就发现我还是不会玩EBAZ4205于是我又买了一块来自MicroPhase的Z7-Lite

还是老实用开发板比较方便...(。_。)

| 开发软件       | Versino                                 |
| -------------- | --------------------------------------- |
| Vivado         | 2020.2                                  |
| Vitis          | 2020.2                                  |
| Sublime Text3  | 3.2.2, Build 3211                       |
| Icarus Verilog | 12.0 (devel) (s20150603-1110-g18392a46) |

屏幕驱动核心主要借鉴 👉[julbouln/ice40_eink_controller](https://github.com/julbouln/ice40_eink_controller)👈

## 项目目标
### 将输入的图像输出到任意尺寸任意信号(8bit/16bit)的Eink墨水屏[❌]

## 项目概况

- #### 20210721：

  1. 使用LCEDA画了一块Z7-Lite测试ED097TC2的小板子，并发送给捷配打样
  2. 从一个大佬手里扣出了一块TPS65185的Eink电源模块PCB文件，源文件是AD格式由于我不太会用AD转换成LCEDA的格式，打样完成后元器件今天才到齐懒得焊接

- #### 20210804：
  1. 实现Verilog状态机读取EC11旋转编码器，效果还可以~
  2. 焊接完TPS65185模块...没反应...
  3. 焊接完Z7-Lite测试ED097TC2的小板子，发现对板接口弄反了以及把旋转编码器的B相误接到开发板的网口IC复位腿上

- #### 20210805：
  1. 重新绘制并且打样Z7-Lite测试ED097TC2的小板子。打样中，预计20210808到货
  2. TPS65185模块重新打样到货。懒得焊接，元件可能不够

- #### 20210809：
  1. 焊接了新的Z7-Lite测试ED097TC2的小板子，测试发现又画错了好几个地方，飞线解决
  2. 重新画了新的Z7-Lite测试ED097TC2的小板子，不晓得下次又是哪里出错😂
  3. 焊接完成新的TPS65185模块，I2C能够识别但是还未能正常工作

- #### 20210810：
  1. 发现一个很严重的问题，如果Eink的控制信号通过Z7-Lite测试ED097TC2的小板子从IT8951桥接则屏幕会出现模糊、重影等问题，经过检查连接器焊接，线路应该是没问题的 [详见log\20210810] 老老实实按照标准重新绘制控制信号线等长的Z7-Lite测试ED097TC2的小板(说实话有点心疼板厂哈哈哈)!

- #### 20210814：
  1. 今天是七夕节欸...又是单身的一年...

- #### 20210822:
  1. 完成TPS65185的测试程序...
     结果：不知道为啥程序上电会导致花屏幕，由于其他部分未完成，无法确定是否与屏幕信号悬空有关...

- #### 20210828:
  1. 由于在目前的规划中，几乎用不到PS端，所以打算I2C通信直接在PL端上实现以减少搭建系统的复杂度同时提升通用性很苦逼的用Verilog撸I2C模块，网上抄一抄改一改能用就行。由于自身技术不足而且似乎也无需用到完整I2C协议写一个假的I2C或者是完整协议的I2C模块还在考虑中...

- #### 20210829:
  1. 调用 👉[AngeloJacobo/FPGA_I2C_Implementation](https://github.com/AngeloJacobo/FPGA_I2C_Implementation)👈 模块实现FPGA硬件I2C通信，顺利驱动了TPS65185模块!

- #### 20210909:
  1. 原本使用其他大佬绘制的邮票孔连接的TPS65185 MODLE由于我比较菜经常换底板拆装非常麻烦容易损坏。故自己重新绘制了采用NGFF-M-KEY连接器的电源模块。然后09-08 23:40下单09-10 23:40还没投产，可谁让JLC是免费的呢！咕咕咕...咕咕咕...

- #### 20210913:
  1. 莆田因为疫情不让上学啦，我的板子也还没有到...调用👉[Digilent/vivado-library](https://github.com/Digilent/vivado-library)👈实现了HDMI_RX，但是需要重启电脑才能识别到HDMI设备，我使能了HDMI_HPD但是似乎这并没有什么用...也就是目前而言似乎不支持热插拔...哭唧唧!

- #### 20210915:
  1. 画了支持HDMI_RX和NGFF接口的电源模块的新底板，由于线路部分在5mil所以只能用JLC打样!

- #### 20210919:
  1. 受疫情影响板子到现在都还没有到...
  2. 通过萝莉分析仪和FPGA片上iLA采集IT8951的控制时序，我逆向了5个控制信号。理论上这五个控制信号还原后只需要通过波形查找表查表就能够刷屏啦~目前五个控制信号和IT8951的几乎相同，并且支持调整硬件分辨率。

- #### 20210926:
  1. 实现了输入分辨率和所需XCL频率即可自动生成控制时序的帧控制器，目前测试了ED097TC2以及ES133UT1全局刷黑白没有问题~

## 计划任务

- #### 20210721：

  先定个小目标，用PL端或者PS端常规驱动TPS65185模块[✔]
  
- #### 20210804：

  重新绘制Z7-Lite测试ED097TC2的小板子[✔]
  
- #### 20210810：

  重新绘制控制信号线等长的Z7-Lite测试ED097TC2的小板子[✔]
  
- #### 20210822：

  完成帧控制信号部分[✔]
  
- #### 20210828：

  调用I2C模块实现了FPGA硬件控制TPS65185模块[✔]
  
- #### 20210909：

  FPGA实现1bit图像误差扩散算法[❌]

- #### 20210919：

  刷新灰度图像[❌]